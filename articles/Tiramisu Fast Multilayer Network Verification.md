

[TOC]

## Tiramisu: Fast Multilayer Network Verification

### Abstract

分布式网络控制复杂，第 2、3 层多种协议交互，导致网络配置复杂且容易出错。state-of-the-art 检查工具要么是违反了密钥的属性，要么就是速度太慢，或者就是无法对网络中的要素进行建模。

提出了新的通用的多层图控制模型，提供快速、定制属性的验证算法。Tiramisu 能够验证各种实际的和综合的配置是否出错，在小型网络中延迟 < 0.08s，在大型网络中延迟 < 2.2s，比 state-of-the-art 快 2600倍，并且不损失通用性。

### Introduction

许多的网络使用复杂的拓扑结构和分布式控制来实现复杂的目标。在拓扑级别上，网络采用技术将多个链路虚拟化成为逻辑上相互隔离的广播域。网络中的 Control Plane 则是通过使用多种路由协议，与其他的机器通过复杂的方式交换路由信息。这方面的虚拟技术也很常见（例如虚拟化路由和转发）。

在这些协议所需要的详细配置中，很容易产生 bug。很多情况下，网络发生错误，控制收敛到新的路径时，这些 bug 就会被触发，会导致灾难性的后果：

- 可达性黑洞
- 受限制的服务访问可能会变得完全开放
- 可能会导致选择开销较大的路径

有很多的工具试图检验网络是否违反了某个重要策略。

- control plane analyzers 会主动验证网络是否满足针对各个环境下的策略
- ARC（一种基于图算法的工具，State-of-the-art）会把网络中可能出现的所有路径建模成一系列加权有向图
- Minesweeper（基于 SMT 的工具），通过使用逻辑约束/变量来对路由交换信息、路由选择和故障进行编码，完成对 Control Plane 的建模
- Plankton（基于 ESMC 的工具），使用自定义的语言对路由协议进行建模，以便 ESMC 可以探索由 Control Plane 执行产生的许多的 Data Plane 状态

这些 Control Plane 工具性能和通用性很差。ARC 抽象了很多低级别的 Control Plane 细节，使得能够利用多项式时间复杂度的图算法来进行验证，为所有的工具提供好的性能。但是这种抽象忽视了许多网络设计结构，包括 BGP 属性以及 iBGP。虽然其他的工具检查了这些细节，能够在低级别进行建模，但是性能极差，尤其是探索故障时。

所有的工具都忽略了 VLAN 和 VRF。

文章寻求一种快速的通用的 Control Plane 验证工具，同时还考虑 2.5 层的协议，例如 VLAN。

文章的团队发现在性能和通用性之间的权衡在某种程度上是人为的，源于 Control Plane 编码和使用的验证算法的不自然耦合。

Tiramisu 的关键是将编码与验证算法解耦。

- 使用了新的、充足的编码技术，能够对 Control Plane 特征和网络设计结构建模。并且这个编码可以让 Tiramisu 可以针对不同类型的政策自定义验证算法，比 state-of-the-art 大幅提高了性能。
- Tiramisu 的网络模型使用图作为基础，类似于 ARC，但是图模型是多层的，使用了多属性边权重，从而捕获协议之间以及虚拟和物理链路之间的依赖关系，并考虑了过滤器、标签和协议成本/首选项等。
- 对于自定义验证，Tiramisu 指出大部分政策可以分成三类，Tiramisu 利用了底层的图模型结构为每个类型开发高性能的验证算法
  - 需要给出故障情况下网络的实际路径的策略
  - 关心路径可能表现出的某些定量属性的策略
  - 仅仅关注路径是否存在的策略

