## The Design and Implementation of a Log-Structured File System

#### Abstrac：

- 所有文件的修改顺序的添加在 disk 的后面，加速了文件的写以及恢复（消除了所有的寻道）
- disk 上只有唯一的一种数据结构：log，其中包含了索引信息来高效的从 log 中读取数据
- 性能：在小文件写比 UNIX 高一个数量级，在读以及大规模写与 UNIX 相当甚至更优

#### Introduction：

- 现状：CPU 速度不断增加，硬盘速度却增长的缓慢，硬盘读写速度成为大多数应用的瓶颈
- 为了高效，必须保证在写的时候总有足够大的空间，因此将空闲空间划分为 segment，程序 segment cleaner 周期性的压缩严重碎片化的片段来重新生成大的 segment
- segment cleaner 采取的策略：将旧的、变化慢的数据与新的、极速变化的数据区别对待
- 性能：65 ~ 75% 的带宽写数据，剩下的带宽用于 clean（UNIX：5 ~ 10% 的带宽写，剩下的寻道）



#### Desing for file systems of the 1990's

介绍 **技术**以及**任务量**给设计文件系统带来的影响

##### Technology

- 三个重要组件：处理器、硬盘、内存；处理器的速度加快给计算机其他部件的发展带来了压力；硬盘的改进更多的是容量和开销，而不是性能（传输带宽有改进（磁盘阵列以及并联磁头磁盘）、访问时间基本上没有改进）；现代文件系统在内存中缓存了最近的文件数据，内存增大，可以缓存的文件数据更大，通过吸收读取请求可以减少磁盘的工作量，但是最终必须要在磁盘上写入，因此磁盘的性能主要取决于写的性能；大文件缓存可以充当写入的缓冲区，在将任何缓冲区的数据写入磁盘之前可以收集大量修改后的块，使得写数据块更加高效（只需一次寻道），但是也会造成崩溃时丢失的数据更多

##### Workloads

文件系统设计最难有效处理的工作负载是在办公软件核工程软件环境中，这个环境主要取决于访问小文件（小文件经常会产生随机磁盘I/O，创建和删除这些小文件取决于更新文件系统的元数据）

##### Problems with existing file systems

- 将信息分散到磁盘的各个位置，需要多次寻道
- 写数据采取同步的方式，即使 UNIX FFS 写数据块是异步的，但是对于文件系统的元数据的写仍然是同步的