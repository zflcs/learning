[TOC]



### A Study of Linux File System Evolution

#### Abstract

##### Introduction

- 对这些文件系统的代码不了解，到底这个文件系统的复杂性在哪？共同的问题？存在哪些性能特性？使用了那个可靠性特点？
- 根据 linux 的补丁，其中 40% 都是在修复 bug，因此提出未来的系统设计需要更好的工具或者语言支持，通过对过去的 bug、性能、可靠性补丁的学习，进一步了解问题和挑战在哪，创造出更好的下一代文件系统

#### Methodology

- 首先挑选出目标文件系统，选出最具有特色的（数据结构、可靠性、性能优化、高级特性等方面）
- 将文件系统的补丁分类，对每个文件系统的演化版本进行全面调研，回答三个基本问题
    - Overview：文件系统中常见的补丁有哪些？这些补丁随着文件系统的发展如何变化？不同类型的补丁是否具有不同的大小？
    - Bugs：文件系统出现什么类型的 bugs？文件系统的组件是否比其他部分存在更多 bugs？这些不同的 bugs 会导致什么样的后果？
    - Performance：文件系统中采用了什么技术改进性能以及可靠性？

#### Patch Overview

- Patch Type：近一半的补丁用于代码维护和记录；大量错误不仅存在于新的文件系统中，还存在于稳定的文件系统；所有文件系统都特别努力改进其性能和可靠性；功能修补补丁占总补丁的相对较小的百分比。

- Patch Trend：bugs 补丁并没有减少
- Patch Size：错误补丁通常很小；复杂的文件系统有更大的错误补丁；可靠性和性能补丁是中等大小的；功能补丁明显大于其他补丁

#### File System Bugs

- Correlation Between Code and Bugs：所有文件系统中 file、inode、super component 的 bug 密度非常高；transactional code 因为代码量大，所以错误也多，但是基本上是成比例的；tree component 的 bug 少
- Bug Patterns：除了维护之外，错误修复是最常见的补丁类型；超过一半的文件系统错误是语义错误，可能需要领域知识查找并修复；与用户级软件相比，文件系统的并发错误百分比更高；内存和错误代码错误出现，但百分比较小
- Bug Trends：bug 的模式不会发生显著变化
- Bug Consequences：损坏和崩溃最为常见；语义 bug 可能导致大量的损坏、崩溃、错误和挂起；所有的 bug 类型都会造成严重后果

##### Bug Pattern Examples and Analysis

- Semantic Bugs：不正确的状态更新和逻辑错误是主要的语义错误模式；配置错误也不少见；不正确的 I/O 排序很少见（但可能产生严重后果）；通用错误需要了解的文件系统知识最少。
- Concurrency Bugs：在文件系统中而不是在用户级软件中，并发错误更为常见。原子性和死锁错误代表了绝大多数并发错误；许多死锁错误是由错误的内核内存分配标志引起的；大多数丢失的解锁发生在退出或故障路径上。
- Memory Bugs：资源泄漏是最大的内存错误，明显高于用户级内存错误；空指针取消引用也很常见；故障路径对这些错误有很大影响；这些错误修复比较简单
- Error Code Bugs：主要是两类，一是缺少某种类型的错误处理；另一种是错误处理不正确

##### The Failure Path

- 很大一部分错误是由于在存在故障或错误时的不当行为而发生的
- 在很少执行的代码路径上，与内存相关的 bug 很常见
- 四分之一的语义错误是在故障路径上发现的

####  Performance and Reliability

- 性能补丁存在于所有文件系统中；同步、访问和分割占总数的四分之一；使用的许多技术都相当标准
    （例如，移除锁）；在研究新的同步原语时，不应该忘记性能
- 可靠性补丁被添加到文件系统随时间推移作为强化的一部分；大多数添加简单的检查，防止损坏从
    磁盘，或通过返回错误来提高可用性的崩溃；注释有助于在编译时发现问题时间；调试补丁添加诊断信息；跨所有文件系统使用可靠性修补程序似乎是临时的